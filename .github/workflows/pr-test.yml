name: Test Issue Action
on:
  pull_request:

jobs:
  test-action:
    runs-on: ${{ matrix.os }}
    env:
      TERM: xterm
    strategy:
      matrix:
        os:
          - ubuntu-20.04

    steps:
      - uses: actions/checkout@v2
      - name: Create test issue
        uses: actions/github-script@v5
        id: new-issue
        with:
          debug: true
          result-encoding: string
          script: |
            try {
              const response = await github.rest.issues.create({
                owner: context.repo.owner,
                repo: 'transfer-issue-action',
                title: 'Transfer Issue Action Test Issue'
              });
              return response.data.node_id;
            } catch (error) {
              core.setFailed(error.message);
            }
      - name: Get and set test issue id
        id: test-issue
        run: |
          echo "::set-output name=id::${{steps.new-issue.outputs.result}}"
      - name: Test Action
        id: test_action
        uses: ./
        with:
          token: ${{ secrets.TRANSFER_ISSUE_TOKEN }}
          router: holla:transfer-issue-action
          apply_label: "Needs Triage:C0FFEE"
          create_stub: true
          debug: true
          test: "${{steps.test-issue.outputs.id}}:holla"

      # - name: Echo Output Data
      #   if: steps.test_action.outputs.new_issue_number != ''
      #   run: |
      #     echo ${{steps.test_action.outputs.new_issue_number}}
      #     echo ${{steps.test_action.outputs.new_issue_url}}
      #     echo ${{steps.test_action.outputs.destination_repo}}


