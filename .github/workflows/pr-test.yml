name: Test Issue Action
on:
  pull_request:

jobs:
  test-action:
    runs-on: ${{ matrix.os }}
    env:
      TERM: xterm
    strategy:
      matrix:
        os:
          - ubuntu-20.04

    steps:
      - uses: actions/checkout@v2
      - name: Create test issue
        uses: actions/github-script@v5
        id: new-issue
        with:
          debug: true
          result-encoding: string
          script: |
            try {
              const response = await github.rest.issues.create({
                owner: context.repo.owner,
                repo: 'transfer-issue-action',
                title: 'Transfer Issue Action Tests'
              });
              return response.data.node_id;
            } catch (error) {
              core.setFailed(error.message);
            }
      - name: Get new issue id
        id: test-issue
        run: |
          echo "${{steps.new-issue.outputs.result}}"
          # echo "::set-output name=SOURCE_NAME::${GITHUB_REF#refs/*/}"
          # echo "::set-output name=SOURCE_BRANCH::${GITHUB_REF#refs/heads/}"
          # echo "::set-output name=SOURCE_TAG::${GITHUB_REF#refs/tags/}"

      # - name: Test Action
      #   id: test_action
      #   uses: ./
      #   with:
      #     token: ${{ secrets.TRANSFER_ISSUE_TOKEN }}
      #     router: holla:lando
      #     apply_label: "Needs Triage:C0FFEE"
      #     create_stub: true
      #     debug: true
      #     test_issue: ${{ matrix.test-labels }}

      # - name: Echo Output Data
      #   if: steps.test_action.outputs.new_issue_number != ''
      #   run: |
      #     echo ${{steps.test_action.outputs.new_issue_number}}
      #     echo ${{steps.test_action.outputs.new_issue_url}}
      #     echo ${{steps.test_action.outputs.destination_repo}}


